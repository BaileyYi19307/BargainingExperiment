{{ block title }}
    Page title
{{ endblock }}
{{ block content }}

<div id="player-values">
    P1: <span id="p1-value">__</span>
    P2: <span id="p2-value">__</span>
    P3: <span id="p3-value">__</span>
</div>

<div class="lv1 layers">
    <button id="btn0_3_0" class="button" type="button" onclick="test('btn0_3_0')"></button>
    <button id="btn0_2_1" class="button" type="button" onclick="test('btn0_2_1')"></button>
    <button id="btn0_1_2" class="button" type="button" onclick="test('btn0_1_2')"></button>
    <button id="btn0_0_3" class="button" type="button" onclick="test('btn0_0_3')"></button>
</div>
<div class="lv2 layers">
    <button id="btn1_2_0" class="button" type="button" onclick="test('btn1_2_0')"></button>
    <button id="btn1_1_1" class="button" type="button" onclick="test('btn1_1_1')"></button>
    <button id="btn1_0_2" class="button" type="button" onclick="test('btn1_0_2')"></button>
</div>
<div class="lv3 layers">
    <button id="btn2_1_0" class="button" type="button" onclick="test('btn2_1_0')"></button>
    <button id="btn2_0_1" class="button" type="button" onclick="test('btn2_0_1')"></button>
</div>
<div class="lv4 layers">
    <button id="btn3_0_0" class="button" type="button" onclick="test('btn3_0_0')"></button>
</div>

    <script>


    function test(buttonId) {
        liveSend({button_clicked: true, button_id:buttonId});
    }
    var borderColors = {
    red: false,
    blue: false,
    green: false
    };

    var buttonStates = {
        btn0_3_0: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn0_2_1: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn0_1_2: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn0_0_3: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn1_2_0: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn1_1_1: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn1_0_2: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn2_1_0: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn2_0_1: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false},
        btn3_0_0: { clickedByUser1: false, clickedByUser2: false, clickedByUser3: false}
    };

    function setPlayerValues(buttonId) {
        var values = buttonId.replace('btn', '').split('_').map(Number);

        document.getElementById('p1-value').textContent = values[0];
        document.getElementById('p2-value').textContent = values[1];
        document.getElementById('p3-value').textContent = values[2];
    }

function liveRecv(data) {
    var button = document.getElementById(data.button_id);
    var btnState = buttonStates[data.button_id];

    if (data.player_id === 1) {
        btnState.clickedByUser1 = !btnState.clickedByUser1;
    } else if (data.player_id == 2) {
        btnState.clickedByUser2 = !btnState.clickedByUser2;
    } else if (data.player_id == 3) {
        btnState.clickedByUser3 = !btnState.clickedByUser3;
    }

    // Reset states for player who moved to different button
    Object.keys(buttonStates).forEach(function(otherButtonId) {
        if (otherButtonId !== data.button_id) {
            var otherBtnState = buttonStates[otherButtonId];
            if (data.player_id === 1) {
                otherBtnState.clickedByUser1 = false;
            } else if (data.player_id == 2) {
                otherBtnState.clickedByUser2 = false;
            } else if (data.player_id == 3) {
                otherBtnState.clickedByUser3 = false;
            }
            updateButtonAppearance(document.getElementById(otherButtonId), otherBtnState);
        }
    });

    // update the appearance of currently clicked button
    updateButtonAppearance(button, btnState);
    if (data.player_id === window.playerId) {
        setPlayerValues(data.button_id);
    }
}

function updateButtonAppearance(button, btnState) {
    button.classList.remove('red-border', 'blue-border', 'green-border', 'red-blue', 'red-green', 'green-blue', 'blue-red', 'green-red', 'blue-green', 'all-borders');

    var playerColor = { // color of players depending on different player's points of views
        1: {1: 'green', 2: 'red', 3: 'blue'},
        2: {1: 'blue', 2: 'green', 3: 'red'},
        3: {1: 'red', 2: 'blue', 3: 'green'}
    };

    function getColorBorderClass(playerNum) {
        return playerColor[window.playerId][playerNum] + '-border';
    }

    function getCombinedColorClass(playerNum1, playerNum2) {
        var colors = [playerColor[window.playerId][playerNum1], playerColor[window.playerId][playerNum2]].sort();
        return colors.join('-');
    }

    // handling color combinations
    var activePlayers = [];
    if (btnState.clickedByUser1) activePlayers.push(1);
    if (btnState.clickedByUser2) activePlayers.push(2);
    if (btnState.clickedByUser3) activePlayers.push(3);

    if (activePlayers.length === 3) {
        button.classList.add('all-borders');
    } else if (activePlayers.length === 2) {
        button.classList.add(getCombinedColorClass(activePlayers[0], activePlayers[1]));
    } else if (activePlayers.length === 1) {
        button.classList.add(getColorBorderClass(activePlayers[0]));
    }
}

// get and store the player's ID
window.playerId = {{ player.id_in_group }};



    </script>


    <style>
        .button{
            width:30px;
            height:30px;
            border-radius:50%;
        }

        .red-border{
            border: 2px solid red;
        }

        .blue-border{
            border: 2px solid blue;
        }

        .green-border{
            border: 2px solid green;
        }

        /*.both-borders{*/
        /*    border: none; !* Remove default border *!*/
        /*    box-shadow: 0 0 0 2px red, 0 0 0 4px blue; !* Create a purple border with red and blue shadows *!*/
        /*}*/

        .red-blue{
            border: none; /* Remove default border */
            box-shadow: 0 0 0 2px red, 0 0 0 4px blue; /* Create a purple border with red and blue shadows */
        }

        .red-green{
            border: none; /* Remove default border */
            box-shadow: 0 0 0 2px red, 0 0 0 4px green; /* Create a purple border with red and blue shadows */
        }

        .green-blue{
            border: none; /* Remove default border */
            box-shadow: 0 0 0 2px green, 0 0 0 4px blue; /* Create a purple border with red and blue shadows */
        }

        .blue-red{
            border: none; /* Remove default border */
            box-shadow: 0 0 0 2px red, 0 0 0 4px blue; /* Create a purple border with red and blue shadows */
        }

        .green-red{
            border: none; /* Remove default border */
            box-shadow: 0 0 0 2px red, 0 0 0 4px green; /* Create a purple border with red and blue shadows */
        }

        .blue-green{
            border: none; /* Remove default border */
            box-shadow: 0 0 0 2px green, 0 0 0 4px blue; /* Create a purple border with red and blue shadows */
        }

        .all-borders{
            border: none; /* Remove default border */
            box-shadow: 0 0 0 2px red, 0 0 0 4px blue, 0 0 0 6px green; /* Create a purple border with red and blue shadows */
        }

        .layers{
            display:flex;
            flex-direction: row;
            justify-content: center;
            align-content: center;
        }



    </style>

    {{ formfields }}
    {{ next_button }}

{{ endblock }}
